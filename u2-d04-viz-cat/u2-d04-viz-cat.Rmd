---
title: "Visualising categorical data"
subtitle: "<br><br> ENST 320: Environmental Data Science"
author: "[https://enst320-2022sp.netlify.app/](https://enst320-2022sp.netlify.app/)"
output:
  xaringan::moon_reader:
    css: ["../xaringan-themer.css", "../slides.css"]
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightLines: true
      highlightStyle: solarized-light
      countIncrementalSlides: false
---

```{r child = "../setup.Rmd"}
```

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(openintro)
loans_full_schema <- loans_full_schema %>%
  mutate(grade = factor(grade, ordered = TRUE))
```

class: middle

# Recap

---

## Variables

- **Numerical** variables can be classified as **continuous** or **discrete** based on whether or not the variable can take on an infinite number of values or only non-negative whole numbers, respectively.
- If the variable is **categorical**, we can determine if it is **ordinal** based on whether or not the levels have a natural ordering.

---

### Data 

```{r}
library(openintro)
loans <- loans_full_schema %>%
  select(loan_amount, interest_rate, term, grade, 
         state, annual_income, homeownership, debt_to_income)
glimpse(loans)
```

---

class: middle

# Bar plot

---

## Bar plot

```{r}
ggplot(loans, aes(x = homeownership)) +
  geom_bar()
```

---

## Segmented bar plot

```{r}
ggplot(loans, aes(x = homeownership, 
                  fill = grade)) + #<<
  geom_bar()
```

---

## Segmented bar plot

```{r}
ggplot(loans, aes(x = homeownership, fill = grade)) +
  geom_bar(position = "fill") #<<
```

---

.question[
Which bar plot is a more useful representation for visualizing the relationship between homeownership and grade?
]

.pull-left[
```{r echo=FALSE, out.width = "100%"}
ggplot(loans, aes(x = homeownership, fill = grade)) +
  geom_bar()
```
]
.pull-right[
```{r echo=FALSE, out.width = "100%"}
ggplot(loans, aes(x = homeownership, fill = grade)) +
  geom_bar(position = "fill")
```
]

---

## Customizing bar plots

.panelset[
.panel[.panel-name[Plot]
```{r ref.label = "bar-custom", echo = FALSE, warning = FALSE}
```
]
.panel[.panel-name[Code]
```{r bar-custom, fig.show = "hide", warning = FALSE}
ggplot(loans, aes(y = homeownership, #<<
                  fill = grade)) +
  geom_bar(position = "fill") +
  labs( #<<
    x = "Proportion", #<<
    y = "Homeownership", #<<
    fill = "Grade", #<<
    title = "Grades of Lending Club loans", #<<
    subtitle = "and homeownership of lendee" #<<
  ) #<<
```
]
]

---

class: middle

# Relationships between numerical and categorical variables

---

## Already talked about...

- Coloring and faceting histograms and density plots
- Side-by-side box plots

---

## Violin plots

```{r warning = FALSE}
ggplot(loans, aes(x = homeownership, y = loan_amount)) +
  geom_violin()
```

---

## Ridge plots

```{r warning = FALSE}
library(ggridges)
ggplot(loans, aes(x = loan_amount, y = grade, fill = grade, color = grade)) + 
  geom_density_ridges(alpha = 0.5)
```

---

## Bar plots with numeric and categorical data
The starwars dataset illustrates this better.
This is useful when you have one observation per categorical variable, or if you have calculated a summary statistic for each level of a categorical variable.
Use `stat = "identity"` in the `geom_bar()` function
```{r}
ggplot(starwars[1:10,] , aes(x = name, y = height)) +
  geom_bar(stat = "identity")
```

---

## Bar plots with numeric and categorical data
Not very pretty - plot name on the y-axis
```{r}
ggplot(starwars[1:40,], aes(x = height, y = name)) +
  geom_bar(stat = "identity")
```

---

## Bar plots with numeric and categorical data
Not very pretty - reorder name by height. And let's color the bars by homeworld, make the labels nicer, and use a nicer theme while we're at it.
```{r}
ggplot(starwars[1:40,], aes(x = height, y = reorder(name, height), fill = homeworld)) +
  geom_bar(stat = "identity") +
  labs(x = "Height (cm)", 
       y = "", 
       fill = "Homeworld", 
       title = "Starwars character height and homeworld") +
  theme_minimal()
```

---
